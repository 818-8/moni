"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "pages/api/gemini/chat";
exports.ids = ["pages/api/gemini/chat"];
exports.modules = {

/***/ "next/dist/compiled/next-server/pages-api.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/pages-api.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/pages-api.runtime.dev.js");

/***/ }),

/***/ "@google/genai":
/*!********************************!*\
  !*** external "@google/genai" ***!
  \********************************/
/***/ ((module) => {

module.exports = import("@google/genai");;

/***/ }),

/***/ "(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fgemini%2Fchat&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Cgemini%5Cchat.ts&middlewareConfigBase64=e30%3D!":
/*!********************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fgemini%2Fchat&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Cgemini%5Cchat.ts&middlewareConfigBase64=e30%3D! ***!
  \********************************************************************************************************************************************************************************************************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__),\n/* harmony export */   routeModule: () => (/* binding */ routeModule)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/pages-api/module.compiled */ \"(api)/./node_modules/next/dist/server/future/route-modules/pages-api/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(api)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/build/templates/helpers */ \"(api)/./node_modules/next/dist/build/templates/helpers.js\");\n/* harmony import */ var _pages_api_gemini_chat_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./pages\\api\\gemini\\chat.ts */ \"(api)/./pages/api/gemini/chat.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_pages_api_gemini_chat_ts__WEBPACK_IMPORTED_MODULE_3__]);\n_pages_api_gemini_chat_ts__WEBPACK_IMPORTED_MODULE_3__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n\n// Import the userland code.\n\n// Re-export the handler (should be the default export).\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_gemini_chat_ts__WEBPACK_IMPORTED_MODULE_3__, \"default\"));\n// Re-export config.\nconst config = (0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_gemini_chat_ts__WEBPACK_IMPORTED_MODULE_3__, \"config\");\n// Create and export the route module that will be consumed.\nconst routeModule = new next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__.PagesAPIRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.PAGES_API,\n        page: \"/api/gemini/chat\",\n        pathname: \"/api/gemini/chat\",\n        // The following aren't used in production.\n        bundlePath: \"\",\n        filename: \"\"\n    },\n    userland: _pages_api_gemini_chat_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n\n//# sourceMappingURL=pages-api.js.map\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LXJvdXRlLWxvYWRlci9pbmRleC5qcz9raW5kPVBBR0VTX0FQSSZwYWdlPSUyRmFwaSUyRmdlbWluaSUyRmNoYXQmcHJlZmVycmVkUmVnaW9uPSZhYnNvbHV0ZVBhZ2VQYXRoPS4lMkZwYWdlcyU1Q2FwaSU1Q2dlbWluaSU1Q2NoYXQudHMmbWlkZGxld2FyZUNvbmZpZ0Jhc2U2ND1lMzAlM0QhIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7O0FBQXNHO0FBQ3ZDO0FBQ0w7QUFDMUQ7QUFDMEQ7QUFDMUQ7QUFDQSxpRUFBZSx3RUFBSyxDQUFDLHNEQUFRLFlBQVksRUFBQztBQUMxQztBQUNPLGVBQWUsd0VBQUssQ0FBQyxzREFBUTtBQUNwQztBQUNPLHdCQUF3QixnSEFBbUI7QUFDbEQ7QUFDQSxjQUFjLHlFQUFTO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0wsWUFBWTtBQUNaLENBQUM7O0FBRUQscUMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly91bmlzb2NpYWwtLS3lpKflrabnlJ/npL7kuqTnp4HmlZkvPzI4NGUiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgUGFnZXNBUElSb3V0ZU1vZHVsZSB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2Z1dHVyZS9yb3V0ZS1tb2R1bGVzL3BhZ2VzLWFwaS9tb2R1bGUuY29tcGlsZWRcIjtcbmltcG9ydCB7IFJvdXRlS2luZCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2Z1dHVyZS9yb3V0ZS1raW5kXCI7XG5pbXBvcnQgeyBob2lzdCB9IGZyb20gXCJuZXh0L2Rpc3QvYnVpbGQvdGVtcGxhdGVzL2hlbHBlcnNcIjtcbi8vIEltcG9ydCB0aGUgdXNlcmxhbmQgY29kZS5cbmltcG9ydCAqIGFzIHVzZXJsYW5kIGZyb20gXCIuL3BhZ2VzXFxcXGFwaVxcXFxnZW1pbmlcXFxcY2hhdC50c1wiO1xuLy8gUmUtZXhwb3J0IHRoZSBoYW5kbGVyIChzaG91bGQgYmUgdGhlIGRlZmF1bHQgZXhwb3J0KS5cbmV4cG9ydCBkZWZhdWx0IGhvaXN0KHVzZXJsYW5kLCBcImRlZmF1bHRcIik7XG4vLyBSZS1leHBvcnQgY29uZmlnLlxuZXhwb3J0IGNvbnN0IGNvbmZpZyA9IGhvaXN0KHVzZXJsYW5kLCBcImNvbmZpZ1wiKTtcbi8vIENyZWF0ZSBhbmQgZXhwb3J0IHRoZSByb3V0ZSBtb2R1bGUgdGhhdCB3aWxsIGJlIGNvbnN1bWVkLlxuZXhwb3J0IGNvbnN0IHJvdXRlTW9kdWxlID0gbmV3IFBhZ2VzQVBJUm91dGVNb2R1bGUoe1xuICAgIGRlZmluaXRpb246IHtcbiAgICAgICAga2luZDogUm91dGVLaW5kLlBBR0VTX0FQSSxcbiAgICAgICAgcGFnZTogXCIvYXBpL2dlbWluaS9jaGF0XCIsXG4gICAgICAgIHBhdGhuYW1lOiBcIi9hcGkvZ2VtaW5pL2NoYXRcIixcbiAgICAgICAgLy8gVGhlIGZvbGxvd2luZyBhcmVuJ3QgdXNlZCBpbiBwcm9kdWN0aW9uLlxuICAgICAgICBidW5kbGVQYXRoOiBcIlwiLFxuICAgICAgICBmaWxlbmFtZTogXCJcIlxuICAgIH0sXG4gICAgdXNlcmxhbmRcbn0pO1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1wYWdlcy1hcGkuanMubWFwIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fgemini%2Fchat&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Cgemini%5Cchat.ts&middlewareConfigBase64=e30%3D!\n");

/***/ }),

/***/ "(api)/./pages/api/gemini/chat.ts":
/*!**********************************!*\
  !*** ./pages/api/gemini/chat.ts ***!
  \**********************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ handler)\n/* harmony export */ });\n/* harmony import */ var _google_genai__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @google/genai */ \"@google/genai\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_google_genai__WEBPACK_IMPORTED_MODULE_0__]);\n_google_genai__WEBPACK_IMPORTED_MODULE_0__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\nconst apiKey = process.env.GEMINI_API_KEY;\nif (!apiKey) {\n    console.warn(\"GEMINI_API_KEY not set in environment - API routes will fail without it\");\n}\n// 创建GoogleGenAI实例，只有在有密钥时\nconst ai = apiKey ? new _google_genai__WEBPACK_IMPORTED_MODULE_0__.GoogleGenAI({\n    apiKey\n}) : null;\nasync function handler(req, res) {\n    // Debug: indicate whether server process has the GEMINI_API_KEY (will not log the key)\n    console.log(\"GEMINI_API_KEY present:\", Boolean(process.env.GEMINI_API_KEY));\n    if (req.method !== \"POST\") {\n        res.setHeader(\"Allow\", \"POST\");\n        return res.status(405).json({\n            error: \"Method Not Allowed\"\n        });\n    }\n    try {\n        const { messages, systemInstruction } = req.body;\n        if (!messages || !Array.isArray(messages)) {\n            return res.status(400).json({\n                error: \"Missing messages array in request body\"\n            });\n        }\n        if (!apiKey || !ai) {\n            return res.status(500).json({\n                error: \"Server configuration error: GEMINI_API_KEY not set or invalid\"\n            });\n        }\n        // Build a textual prompt from messages (server side maintains key responsibility: apiKey never exposed)\n        // 正确处理 Sender 枚举，USER 是 'user'，AI 是 'model'\n        const transcript = messages.map((m)=>`${m.sender === \"user\" ? \"用户\" : \"AI\"}: ${m.text}`).join(\"\\n\");\n        const prompt = `${systemInstruction || \"\"}\\n\\nTranscript:\\n${transcript}\\n\\nRespond as the role-play partner in a natural conversational way.`;\n        // 尝试使用备用模型，添加网络连接测试和超时控制\n        const controller = new AbortController();\n        const timeoutId = setTimeout(()=>controller.abort(), 30000); // 30秒超时\n        let generateResponse;\n        try {\n            // 首先尝试使用指定模型\n            // 使用类型转换确保在任何TypeScript环境中都不会出现类型错误\n            generateResponse = await ai.models.generateContent({\n                model: \"gemini-2.5-flash\",\n                contents: [\n                    {\n                        role: \"user\",\n                        parts: [\n                            {\n                                text: prompt\n                            }\n                        ]\n                    }\n                ],\n                config: {\n                    temperature: 0.9\n                },\n                signal: controller.signal\n            });\n            clearTimeout(timeoutId);\n        } catch (modelError) {\n            clearTimeout(timeoutId);\n            console.warn(\"Primary model failed, trying fallback...\", modelError);\n            // 如果失败，尝试备用模型\n            try {\n                const fallbackController = new AbortController();\n                const fallbackTimeoutId = setTimeout(()=>fallbackController.abort(), 30000);\n                // 使用类型转换确保在任何TypeScript环境中都不会出现类型错误\n                generateResponse = await ai.models.generateContent({\n                    model: \"gemini-1.5-flash\",\n                    contents: [\n                        {\n                            role: \"user\",\n                            parts: [\n                                {\n                                    text: prompt\n                                }\n                            ]\n                        }\n                    ],\n                    config: {\n                        temperature: 0.9\n                    },\n                    signal: fallbackController.signal\n                });\n                clearTimeout(fallbackTimeoutId);\n            } catch (fallbackError) {\n                clearTimeout(timeoutId);\n                throw fallbackError; // 重新抛出以便在外部catch中处理\n            }\n        }\n        // 安全获取文本响应，适配 @google/genai 库的响应格式\n        let responseText = \"\";\n        // 尝试多种方式获取文本内容，确保兼容不同版本的 @google/genai 库\n        if (generateResponse && generateResponse.response) {\n            const response = generateResponse.response;\n            if (response.candidates && response.candidates.length > 0) {\n                const candidate = response.candidates[0];\n                if (candidate.content && candidate.content.parts && candidate.content.parts.length > 0) {\n                    const part = candidate.content.parts[0];\n                    if (part.text) {\n                        responseText = part.text;\n                    }\n                }\n            }\n        }\n        // 如果仍未获取到文本，尝试直接访问 response.text\n        if (!responseText && generateResponse && generateResponse.text) {\n            responseText = generateResponse.text;\n        }\n        // 确保返回的文本不为空\n        responseText = responseText || \"（对方未回应）\";\n        return res.status(200).json({\n            text: responseText\n        });\n    } catch (error) {\n        console.error(\"API /api/gemini/chat error:\", error);\n        // 详细记录错误类型和信息\n        const errorDetails = {\n            type: error instanceof Error ? error.name : \"Unknown Error\",\n            message: error instanceof Error ? error.message : String(error),\n            stack: error instanceof Error && \"development\" === \"development\" ? error.stack : undefined\n        };\n        console.error(\"Detailed error information:\", JSON.stringify(errorDetails, null, 2));\n        // 详细的错误分类和响应\n        if (error.name === \"AbortError\") {\n            return res.status(504).json({\n                error: \"网络连接超时：无法连接到Gemini服务。\",\n                details: \"请求处理时间超过了30秒的超时限制。\\n\\n可能的解决方案：\\n1. 检查防火墙设置，确保允许连接到Google API\\n2. 如果使用VPN，请尝试暂时断开\\n3. 检查网络代理设置\\n4. 稍后再试，服务可能暂时不可用\",\n                timestamp: new Date().toISOString()\n            });\n        }\n        if (error.message.includes(\"403\") || error.message.includes(\"unauthorized\")) {\n            return res.status(401).json({\n                error: \"API密钥无效或权限不足\",\n                details: \"提供的Gemini API密钥无效或者没有足够的权限访问指定的资源。\",\n                timestamp: new Date().toISOString()\n            });\n        }\n        if (error.message.includes(\"429\")) {\n            return res.status(429).json({\n                error: \"请求频率过高，请稍后再试\",\n                details: \"您已达到API请求限制。请减少请求频率或稍后再试。\",\n                timestamp: new Date().toISOString()\n            });\n        }\n        if (error.message.includes(\"ENOTFOUND\") || error.message.includes(\"ECONNREFUSED\")) {\n            return res.status(503).json({\n                error: \"网络连接失败：无法连接到Gemini服务。\",\n                details: \"\\n\\n可能的解决方案：\\n1. 检查防火墙设置，确保允许连接到Google API\\n2. 如果使用VPN，请尝试暂时断开\\n3. 检查网络代理设置\\n4. 稍后再试，服务可能暂时不可用\",\n                timestamp: new Date().toISOString()\n            });\n        }\n        if (error.message.includes(\"API key\")) {\n            return res.status(500).json({\n                error: \"服务器配置错误：API密钥无效\",\n                details: \"服务器无法使用提供的API密钥。请检查环境变量配置。\",\n                timestamp: new Date().toISOString()\n            });\n        }\n        if (error instanceof Error && error.message.includes(\"fetch failed\")) {\n            return res.status(500).json({\n                error: \"网络错误连接到Gemini API\",\n                details: \"可能是网络连接问题或Gemini API服务不可用。请检查网络连接并重试。\",\n                timestamp: new Date().toISOString()\n            });\n        }\n        return res.status(500).json({\n            error: \"服务器处理请求时出错\",\n            details: error instanceof Error ? error.message : String(error),\n            timestamp: new Date().toISOString()\n        });\n    }\n}\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9wYWdlcy9hcGkvZ2VtaW5pL2NoYXQudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFDMEQ7QUFFMUQsTUFBTUMsU0FBU0MsUUFBUUMsR0FBRyxDQUFDQyxjQUFjO0FBRXpDLElBQUksQ0FBQ0gsUUFBUTtJQUNYSSxRQUFRQyxJQUFJLENBQUM7QUFDZjtBQUVBLDBCQUEwQjtBQUMxQixNQUFNQyxLQUFLTixTQUFTLElBQUlELHNEQUFXQSxDQUFDO0lBQUVDO0FBQU8sS0FBSztBQUVuQyxlQUFlTyxRQUFRQyxHQUFtQixFQUFFQyxHQUFvQjtJQUM3RSx1RkFBdUY7SUFDdkZMLFFBQVFNLEdBQUcsQ0FBQywyQkFBMkJDLFFBQVFWLFFBQVFDLEdBQUcsQ0FBQ0MsY0FBYztJQUN6RSxJQUFJSyxJQUFJSSxNQUFNLEtBQUssUUFBUTtRQUN6QkgsSUFBSUksU0FBUyxDQUFDLFNBQVM7UUFDdkIsT0FBT0osSUFBSUssTUFBTSxDQUFDLEtBQUtDLElBQUksQ0FBQztZQUFFQyxPQUFPO1FBQXFCO0lBQzVEO0lBRUEsSUFBSTtRQUNGLE1BQU0sRUFBRUMsUUFBUSxFQUFFQyxpQkFBaUIsRUFBRSxHQUFHVixJQUFJVyxJQUFJO1FBRWhELElBQUksQ0FBQ0YsWUFBWSxDQUFDRyxNQUFNQyxPQUFPLENBQUNKLFdBQVc7WUFDekMsT0FBT1IsSUFBSUssTUFBTSxDQUFDLEtBQUtDLElBQUksQ0FBQztnQkFBRUMsT0FBTztZQUF5QztRQUNoRjtRQUVBLElBQUksQ0FBQ2hCLFVBQVUsQ0FBQ00sSUFBSTtZQUNsQixPQUFPRyxJQUFJSyxNQUFNLENBQUMsS0FBS0MsSUFBSSxDQUFDO2dCQUFFQyxPQUFPO1lBQWdFO1FBQ3ZHO1FBRUEsd0dBQXdHO1FBQ3hHLDRDQUE0QztRQUM1QyxNQUFNTSxhQUFhTCxTQUFTTSxHQUFHLENBQUMsQ0FBQ0MsSUFBVyxDQUFDLEVBQUVBLEVBQUVDLE1BQU0sS0FBSyxTQUFTLE9BQU8sS0FBSyxFQUFFLEVBQUVELEVBQUVFLElBQUksQ0FBQyxDQUFDLEVBQUVDLElBQUksQ0FBQztRQUVwRyxNQUFNQyxTQUFTLENBQUMsRUFBRVYscUJBQXFCLEdBQUcsaUJBQWlCLEVBQUVJLFdBQVcscUVBQXFFLENBQUM7UUFFOUkseUJBQXlCO1FBQ3pCLE1BQU1PLGFBQWEsSUFBSUM7UUFDdkIsTUFBTUMsWUFBWUMsV0FBVyxJQUFNSCxXQUFXSSxLQUFLLElBQUksUUFBUSxRQUFRO1FBRXZFLElBQUlDO1FBQ0osSUFBSTtZQUNGLGFBQWE7WUFDYixvQ0FBb0M7WUFDcENBLG1CQUFtQixNQUFNNUIsR0FBRzZCLE1BQU0sQ0FBQ0MsZUFBZSxDQUFDO2dCQUNqREMsT0FBTztnQkFDUEMsVUFBVTtvQkFBQzt3QkFBRUMsTUFBTTt3QkFBUUMsT0FBTzs0QkFBQztnQ0FBRWQsTUFBTUU7NEJBQU87eUJBQUU7b0JBQUM7aUJBQUU7Z0JBQ3ZEYSxRQUFRO29CQUFFQyxhQUFhO2dCQUFJO2dCQUMzQkMsUUFBUWQsV0FBV2MsTUFBTTtZQUMzQjtZQUNBQyxhQUFhYjtRQUNmLEVBQUUsT0FBT2MsWUFBWTtZQUNuQkQsYUFBYWI7WUFDYjNCLFFBQVFDLElBQUksQ0FBQyw0Q0FBNEN3QztZQUN6RCxjQUFjO1lBQ2QsSUFBSTtnQkFDRixNQUFNQyxxQkFBcUIsSUFBSWhCO2dCQUMvQixNQUFNaUIsb0JBQW9CZixXQUFXLElBQU1jLG1CQUFtQmIsS0FBSyxJQUFJO2dCQUV2RSxvQ0FBb0M7Z0JBQ3BDQyxtQkFBbUIsTUFBTTVCLEdBQUc2QixNQUFNLENBQUNDLGVBQWUsQ0FBQztvQkFDakRDLE9BQU87b0JBQ1BDLFVBQVU7d0JBQUM7NEJBQUVDLE1BQU07NEJBQVFDLE9BQU87Z0NBQUM7b0NBQUVkLE1BQU1FO2dDQUFPOzZCQUFFO3dCQUFDO3FCQUFFO29CQUN2RGEsUUFBUTt3QkFBRUMsYUFBYTtvQkFBSTtvQkFDM0JDLFFBQVFHLG1CQUFtQkgsTUFBTTtnQkFDbkM7Z0JBQ0FDLGFBQWFHO1lBQ2YsRUFBRSxPQUFPQyxlQUFlO2dCQUN0QkosYUFBYWI7Z0JBQ2IsTUFBTWlCLGVBQWUsb0JBQW9CO1lBQzNDO1FBQ0Y7UUFFQSxtQ0FBbUM7UUFDbkMsSUFBSUMsZUFBZTtRQUVuQix5Q0FBeUM7UUFDekMsSUFBSWYsb0JBQW9CQSxpQkFBaUJnQixRQUFRLEVBQUU7WUFDakQsTUFBTUEsV0FBV2hCLGlCQUFpQmdCLFFBQVE7WUFDMUMsSUFBSUEsU0FBU0MsVUFBVSxJQUFJRCxTQUFTQyxVQUFVLENBQUNDLE1BQU0sR0FBRyxHQUFHO2dCQUN6RCxNQUFNQyxZQUFZSCxTQUFTQyxVQUFVLENBQUMsRUFBRTtnQkFDeEMsSUFBSUUsVUFBVUMsT0FBTyxJQUFJRCxVQUFVQyxPQUFPLENBQUNkLEtBQUssSUFBSWEsVUFBVUMsT0FBTyxDQUFDZCxLQUFLLENBQUNZLE1BQU0sR0FBRyxHQUFHO29CQUN0RixNQUFNRyxPQUFPRixVQUFVQyxPQUFPLENBQUNkLEtBQUssQ0FBQyxFQUFFO29CQUN2QyxJQUFJZSxLQUFLN0IsSUFBSSxFQUFFO3dCQUNidUIsZUFBZU0sS0FBSzdCLElBQUk7b0JBQzFCO2dCQUNGO1lBQ0Y7UUFDRjtRQUVBLGlDQUFpQztRQUNqQyxJQUFJLENBQUN1QixnQkFBZ0JmLG9CQUFvQkEsaUJBQWlCUixJQUFJLEVBQUU7WUFDOUR1QixlQUFlZixpQkFBaUJSLElBQUk7UUFDdEM7UUFFQSxhQUFhO1FBQ2J1QixlQUFlQSxnQkFBZ0I7UUFFL0IsT0FBT3hDLElBQUlLLE1BQU0sQ0FBQyxLQUFLQyxJQUFJLENBQUM7WUFBRVcsTUFBTXVCO1FBQWE7SUFDbkQsRUFBRSxPQUFPakMsT0FBTztRQUNkWixRQUFRWSxLQUFLLENBQUMsK0JBQStCQTtRQUM3QyxjQUFjO1FBQ2QsTUFBTXdDLGVBQWU7WUFDbkJDLE1BQU16QyxpQkFBaUIwQyxRQUFRMUMsTUFBTTJDLElBQUksR0FBRztZQUM1Q0MsU0FBUzVDLGlCQUFpQjBDLFFBQVExQyxNQUFNNEMsT0FBTyxHQUFHQyxPQUFPN0M7WUFDekQ4QyxPQUFPOUMsaUJBQWlCMEMsU0FBU3pELGtCQUF5QixnQkFBZ0JlLE1BQU04QyxLQUFLLEdBQUdDO1FBQzFGO1FBRUEzRCxRQUFRWSxLQUFLLENBQUMsK0JBQStCZ0QsS0FBS0MsU0FBUyxDQUFDVCxjQUFjLE1BQU07UUFFaEYsYUFBYTtRQUNiLElBQUl4QyxNQUFNMkMsSUFBSSxLQUFLLGNBQWM7WUFDL0IsT0FBT2xELElBQUlLLE1BQU0sQ0FBQyxLQUFLQyxJQUFJLENBQUM7Z0JBQzFCQyxPQUFPO2dCQUNQa0QsU0FBUztnQkFDVEMsV0FBVyxJQUFJQyxPQUFPQyxXQUFXO1lBQ25DO1FBQ0Y7UUFFQSxJQUFJckQsTUFBTTRDLE9BQU8sQ0FBQ1UsUUFBUSxDQUFDLFVBQVV0RCxNQUFNNEMsT0FBTyxDQUFDVSxRQUFRLENBQUMsaUJBQWlCO1lBQzNFLE9BQU83RCxJQUFJSyxNQUFNLENBQUMsS0FBS0MsSUFBSSxDQUFDO2dCQUMxQkMsT0FBTztnQkFDUGtELFNBQVM7Z0JBQ1RDLFdBQVcsSUFBSUMsT0FBT0MsV0FBVztZQUNuQztRQUNGO1FBRUEsSUFBSXJELE1BQU00QyxPQUFPLENBQUNVLFFBQVEsQ0FBQyxRQUFRO1lBQ2pDLE9BQU83RCxJQUFJSyxNQUFNLENBQUMsS0FBS0MsSUFBSSxDQUFDO2dCQUMxQkMsT0FBTztnQkFDUGtELFNBQVM7Z0JBQ1RDLFdBQVcsSUFBSUMsT0FBT0MsV0FBVztZQUNuQztRQUNGO1FBRUEsSUFBSXJELE1BQU00QyxPQUFPLENBQUNVLFFBQVEsQ0FBQyxnQkFBZ0J0RCxNQUFNNEMsT0FBTyxDQUFDVSxRQUFRLENBQUMsaUJBQWlCO1lBQ2pGLE9BQU83RCxJQUFJSyxNQUFNLENBQUMsS0FBS0MsSUFBSSxDQUFDO2dCQUMxQkMsT0FBTztnQkFDUGtELFNBQVM7Z0JBQ1RDLFdBQVcsSUFBSUMsT0FBT0MsV0FBVztZQUNuQztRQUNGO1FBRUEsSUFBSXJELE1BQU00QyxPQUFPLENBQUNVLFFBQVEsQ0FBQyxZQUFZO1lBQ3JDLE9BQU83RCxJQUFJSyxNQUFNLENBQUMsS0FBS0MsSUFBSSxDQUFDO2dCQUMxQkMsT0FBTztnQkFDUGtELFNBQVM7Z0JBQ1RDLFdBQVcsSUFBSUMsT0FBT0MsV0FBVztZQUNuQztRQUNGO1FBRUEsSUFBSXJELGlCQUFpQjBDLFNBQVMxQyxNQUFNNEMsT0FBTyxDQUFDVSxRQUFRLENBQUMsaUJBQWlCO1lBQ3BFLE9BQU83RCxJQUFJSyxNQUFNLENBQUMsS0FBS0MsSUFBSSxDQUFDO2dCQUMxQkMsT0FBTztnQkFDUGtELFNBQVM7Z0JBQ1RDLFdBQVcsSUFBSUMsT0FBT0MsV0FBVztZQUNuQztRQUNGO1FBRUEsT0FBTzVELElBQUlLLE1BQU0sQ0FBQyxLQUFLQyxJQUFJLENBQUM7WUFDMUJDLE9BQU87WUFDUGtELFNBQVNsRCxpQkFBaUIwQyxRQUFRMUMsTUFBTTRDLE9BQU8sR0FBR0MsT0FBTzdDO1lBQ3pEbUQsV0FBVyxJQUFJQyxPQUFPQyxXQUFXO1FBQ25DO0lBQ0Y7QUFDRiIsInNvdXJjZXMiOlsid2VicGFjazovL3VuaXNvY2lhbC0tLeWkp+WtpueUn+ekvuS6pOengeaVmS8uL3BhZ2VzL2FwaS9nZW1pbmkvY2hhdC50cz80MTBlIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB0eXBlIHsgTmV4dEFwaVJlcXVlc3QsIE5leHRBcGlSZXNwb25zZSB9IGZyb20gJ25leHQnO1xyXG5pbXBvcnQgeyBHb29nbGVHZW5BSSwgVHlwZSwgU2NoZW1hIH0gZnJvbSAnQGdvb2dsZS9nZW5haSc7XHJcblxyXG5jb25zdCBhcGlLZXkgPSBwcm9jZXNzLmVudi5HRU1JTklfQVBJX0tFWTtcclxuXHJcbmlmICghYXBpS2V5KSB7XHJcbiAgY29uc29sZS53YXJuKCdHRU1JTklfQVBJX0tFWSBub3Qgc2V0IGluIGVudmlyb25tZW50IC0gQVBJIHJvdXRlcyB3aWxsIGZhaWwgd2l0aG91dCBpdCcpO1xyXG59XHJcblxyXG4vLyDliJvlu7pHb29nbGVHZW5BSeWunuS+i++8jOWPquacieWcqOacieWvhumSpeaXtlxyXG5jb25zdCBhaSA9IGFwaUtleSA/IG5ldyBHb29nbGVHZW5BSSh7IGFwaUtleSB9KSA6IG51bGw7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBhc3luYyBmdW5jdGlvbiBoYW5kbGVyKHJlcTogTmV4dEFwaVJlcXVlc3QsIHJlczogTmV4dEFwaVJlc3BvbnNlKSB7XHJcbiAgLy8gRGVidWc6IGluZGljYXRlIHdoZXRoZXIgc2VydmVyIHByb2Nlc3MgaGFzIHRoZSBHRU1JTklfQVBJX0tFWSAod2lsbCBub3QgbG9nIHRoZSBrZXkpXHJcbiAgY29uc29sZS5sb2coJ0dFTUlOSV9BUElfS0VZIHByZXNlbnQ6JywgQm9vbGVhbihwcm9jZXNzLmVudi5HRU1JTklfQVBJX0tFWSkpO1xyXG4gIGlmIChyZXEubWV0aG9kICE9PSAnUE9TVCcpIHtcclxuICAgIHJlcy5zZXRIZWFkZXIoJ0FsbG93JywgJ1BPU1QnKTtcclxuICAgIHJldHVybiByZXMuc3RhdHVzKDQwNSkuanNvbih7IGVycm9yOiAnTWV0aG9kIE5vdCBBbGxvd2VkJyB9KTtcclxuICB9XHJcblxyXG4gIHRyeSB7XHJcbiAgICBjb25zdCB7IG1lc3NhZ2VzLCBzeXN0ZW1JbnN0cnVjdGlvbiB9ID0gcmVxLmJvZHkgYXMgeyBtZXNzYWdlcz86IEFycmF5PGFueT47IHN5c3RlbUluc3RydWN0aW9uPzogc3RyaW5nIH07XHJcblxyXG4gICAgaWYgKCFtZXNzYWdlcyB8fCAhQXJyYXkuaXNBcnJheShtZXNzYWdlcykpIHtcclxuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHsgZXJyb3I6ICdNaXNzaW5nIG1lc3NhZ2VzIGFycmF5IGluIHJlcXVlc3QgYm9keScgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKCFhcGlLZXkgfHwgIWFpKSB7XHJcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDUwMCkuanNvbih7IGVycm9yOiAnU2VydmVyIGNvbmZpZ3VyYXRpb24gZXJyb3I6IEdFTUlOSV9BUElfS0VZIG5vdCBzZXQgb3IgaW52YWxpZCcgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gQnVpbGQgYSB0ZXh0dWFsIHByb21wdCBmcm9tIG1lc3NhZ2VzIChzZXJ2ZXIgc2lkZSBtYWludGFpbnMga2V5IHJlc3BvbnNpYmlsaXR5OiBhcGlLZXkgbmV2ZXIgZXhwb3NlZClcclxuICAgIC8vIOato+ehruWkhOeQhiBTZW5kZXIg5p6a5Li+77yMVVNFUiDmmK8gJ3VzZXIn77yMQUkg5pivICdtb2RlbCdcclxuICAgIGNvbnN0IHRyYW5zY3JpcHQgPSBtZXNzYWdlcy5tYXAoKG06IGFueSkgPT4gYCR7bS5zZW5kZXIgPT09ICd1c2VyJyA/ICfnlKjmiLcnIDogJ0FJJ306ICR7bS50ZXh0fWApLmpvaW4oJ1xcbicpO1xyXG5cclxuICAgIGNvbnN0IHByb21wdCA9IGAke3N5c3RlbUluc3RydWN0aW9uIHx8ICcnfVxcblxcblRyYW5zY3JpcHQ6XFxuJHt0cmFuc2NyaXB0fVxcblxcblJlc3BvbmQgYXMgdGhlIHJvbGUtcGxheSBwYXJ0bmVyIGluIGEgbmF0dXJhbCBjb252ZXJzYXRpb25hbCB3YXkuYDtcclxuXHJcbiAgICAvLyDlsJ3or5Xkvb/nlKjlpIfnlKjmqKHlnovvvIzmt7vliqDnvZHnu5zov57mjqXmtYvor5XlkozotoXml7bmjqfliLZcclxuICAgIGNvbnN0IGNvbnRyb2xsZXIgPSBuZXcgQWJvcnRDb250cm9sbGVyKCk7XHJcbiAgICBjb25zdCB0aW1lb3V0SWQgPSBzZXRUaW1lb3V0KCgpID0+IGNvbnRyb2xsZXIuYWJvcnQoKSwgMzAwMDApOyAvLyAzMOenkui2heaXtlxyXG4gICAgXHJcbiAgICBsZXQgZ2VuZXJhdGVSZXNwb25zZTtcclxuICAgIHRyeSB7XHJcbiAgICAgIC8vIOmmluWFiOWwneivleS9v+eUqOaMh+WumuaooeWei1xyXG4gICAgICAvLyDkvb/nlKjnsbvlnovovazmjaLnoa7kv53lnKjku7vkvZVUeXBlU2NyaXB0546v5aKD5Lit6YO95LiN5Lya5Ye6546w57G75Z6L6ZSZ6K+vXHJcbiAgICAgIGdlbmVyYXRlUmVzcG9uc2UgPSBhd2FpdCBhaS5tb2RlbHMuZ2VuZXJhdGVDb250ZW50KHtcclxuICAgICAgICBtb2RlbDogJ2dlbWluaS0yLjUtZmxhc2gnLFxyXG4gICAgICAgIGNvbnRlbnRzOiBbeyByb2xlOiAndXNlcicsIHBhcnRzOiBbeyB0ZXh0OiBwcm9tcHQgfV0gfV0sXHJcbiAgICAgICAgY29uZmlnOiB7IHRlbXBlcmF0dXJlOiAwLjkgfSxcclxuICAgICAgICBzaWduYWw6IGNvbnRyb2xsZXIuc2lnbmFsXHJcbiAgICAgIH0gYXMgdW5rbm93biBhcyBhbnkpO1xyXG4gICAgICBjbGVhclRpbWVvdXQodGltZW91dElkKTtcclxuICAgIH0gY2F0Y2ggKG1vZGVsRXJyb3IpIHtcclxuICAgICAgY2xlYXJUaW1lb3V0KHRpbWVvdXRJZCk7XHJcbiAgICAgIGNvbnNvbGUud2FybignUHJpbWFyeSBtb2RlbCBmYWlsZWQsIHRyeWluZyBmYWxsYmFjay4uLicsIG1vZGVsRXJyb3IpO1xyXG4gICAgICAvLyDlpoLmnpzlpLHotKXvvIzlsJ3or5XlpIfnlKjmqKHlnotcclxuICAgICAgdHJ5IHtcclxuICAgICAgICBjb25zdCBmYWxsYmFja0NvbnRyb2xsZXIgPSBuZXcgQWJvcnRDb250cm9sbGVyKCk7XHJcbiAgICAgICAgY29uc3QgZmFsbGJhY2tUaW1lb3V0SWQgPSBzZXRUaW1lb3V0KCgpID0+IGZhbGxiYWNrQ29udHJvbGxlci5hYm9ydCgpLCAzMDAwMCk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgLy8g5L2/55So57G75Z6L6L2s5o2i56Gu5L+d5Zyo5Lu75L2VVHlwZVNjcmlwdOeOr+Wig+S4remDveS4jeS8muWHuueOsOexu+Wei+mUmeivr1xyXG4gICAgICAgIGdlbmVyYXRlUmVzcG9uc2UgPSBhd2FpdCBhaS5tb2RlbHMuZ2VuZXJhdGVDb250ZW50KHtcclxuICAgICAgICAgIG1vZGVsOiAnZ2VtaW5pLTEuNS1mbGFzaCcsXHJcbiAgICAgICAgICBjb250ZW50czogW3sgcm9sZTogJ3VzZXInLCBwYXJ0czogW3sgdGV4dDogcHJvbXB0IH1dIH1dLFxyXG4gICAgICAgICAgY29uZmlnOiB7IHRlbXBlcmF0dXJlOiAwLjkgfSxcclxuICAgICAgICAgIHNpZ25hbDogZmFsbGJhY2tDb250cm9sbGVyLnNpZ25hbFxyXG4gICAgICAgIH0gYXMgdW5rbm93biBhcyBhbnkpO1xyXG4gICAgICAgIGNsZWFyVGltZW91dChmYWxsYmFja1RpbWVvdXRJZCk7XHJcbiAgICAgIH0gY2F0Y2ggKGZhbGxiYWNrRXJyb3IpIHtcclxuICAgICAgICBjbGVhclRpbWVvdXQodGltZW91dElkKTtcclxuICAgICAgICB0aHJvdyBmYWxsYmFja0Vycm9yOyAvLyDph43mlrDmipvlh7rku6Xkvr/lnKjlpJbpg6hjYXRjaOS4reWkhOeQhlxyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLy8g5a6J5YWo6I635Y+W5paH5pys5ZON5bqU77yM6YCC6YWNIEBnb29nbGUvZ2VuYWkg5bqT55qE5ZON5bqU5qC85byPXHJcbiAgICBsZXQgcmVzcG9uc2VUZXh0ID0gJyc7XHJcbiAgICBcclxuICAgIC8vIOWwneivleWkmuenjeaWueW8j+iOt+WPluaWh+acrOWGheWuue+8jOehruS/neWFvOWuueS4jeWQjOeJiOacrOeahCBAZ29vZ2xlL2dlbmFpIOW6k1xyXG4gICAgaWYgKGdlbmVyYXRlUmVzcG9uc2UgJiYgZ2VuZXJhdGVSZXNwb25zZS5yZXNwb25zZSkge1xyXG4gICAgICBjb25zdCByZXNwb25zZSA9IGdlbmVyYXRlUmVzcG9uc2UucmVzcG9uc2U7XHJcbiAgICAgIGlmIChyZXNwb25zZS5jYW5kaWRhdGVzICYmIHJlc3BvbnNlLmNhbmRpZGF0ZXMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgIGNvbnN0IGNhbmRpZGF0ZSA9IHJlc3BvbnNlLmNhbmRpZGF0ZXNbMF07XHJcbiAgICAgICAgaWYgKGNhbmRpZGF0ZS5jb250ZW50ICYmIGNhbmRpZGF0ZS5jb250ZW50LnBhcnRzICYmIGNhbmRpZGF0ZS5jb250ZW50LnBhcnRzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgIGNvbnN0IHBhcnQgPSBjYW5kaWRhdGUuY29udGVudC5wYXJ0c1swXTtcclxuICAgICAgICAgIGlmIChwYXJ0LnRleHQpIHtcclxuICAgICAgICAgICAgcmVzcG9uc2VUZXh0ID0gcGFydC50ZXh0O1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgXHJcbiAgICAvLyDlpoLmnpzku43mnKrojrflj5bliLDmlofmnKzvvIzlsJ3or5Xnm7TmjqXorr/pl64gcmVzcG9uc2UudGV4dFxyXG4gICAgaWYgKCFyZXNwb25zZVRleHQgJiYgZ2VuZXJhdGVSZXNwb25zZSAmJiBnZW5lcmF0ZVJlc3BvbnNlLnRleHQpIHtcclxuICAgICAgcmVzcG9uc2VUZXh0ID0gZ2VuZXJhdGVSZXNwb25zZS50ZXh0O1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICAvLyDnoa7kv53ov5Tlm57nmoTmlofmnKzkuI3kuLrnqbpcclxuICAgIHJlc3BvbnNlVGV4dCA9IHJlc3BvbnNlVGV4dCB8fCAn77yI5a+55pa55pyq5Zue5bqU77yJJztcclxuICAgIFxyXG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoMjAwKS5qc29uKHsgdGV4dDogcmVzcG9uc2VUZXh0IH0pO1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCdBUEkgL2FwaS9nZW1pbmkvY2hhdCBlcnJvcjonLCBlcnJvcik7XHJcbiAgICAvLyDor6bnu4borrDlvZXplJnor6/nsbvlnovlkozkv6Hmga9cclxuICAgIGNvbnN0IGVycm9yRGV0YWlscyA9IHtcclxuICAgICAgdHlwZTogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm5hbWUgOiAnVW5rbm93biBFcnJvcicsXHJcbiAgICAgIG1lc3NhZ2U6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogU3RyaW5nKGVycm9yKSxcclxuICAgICAgc3RhY2s6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgJiYgcHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09ICdkZXZlbG9wbWVudCcgPyBlcnJvci5zdGFjayA6IHVuZGVmaW5lZFxyXG4gICAgfTtcclxuICAgIFxyXG4gICAgY29uc29sZS5lcnJvcignRGV0YWlsZWQgZXJyb3IgaW5mb3JtYXRpb246JywgSlNPTi5zdHJpbmdpZnkoZXJyb3JEZXRhaWxzLCBudWxsLCAyKSk7XHJcbiAgICBcclxuICAgIC8vIOivpue7hueahOmUmeivr+WIhuexu+WSjOWTjeW6lFxyXG4gICAgaWYgKGVycm9yLm5hbWUgPT09ICdBYm9ydEVycm9yJykge1xyXG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg1MDQpLmpzb24oe1xyXG4gICAgICAgIGVycm9yOiAn572R57uc6L+e5o6l6LaF5pe277ya5peg5rOV6L+e5o6l5YiwR2VtaW5p5pyN5Yqh44CCJyxcclxuICAgICAgICBkZXRhaWxzOiAn6K+35rGC5aSE55CG5pe26Ze06LaF6L+H5LqGMzDnp5LnmoTotoXml7bpmZDliLbjgIJcXG5cXG7lj6/og73nmoTop6PlhrPmlrnmoYjvvJpcXG4xLiDmo4Dmn6XpmLLngavlopnorr7nva7vvIznoa7kv53lhYHorrjov57mjqXliLBHb29nbGUgQVBJXFxuMi4g5aaC5p6c5L2/55SoVlBO77yM6K+35bCd6K+V5pqC5pe25pat5byAXFxuMy4g5qOA5p+l572R57uc5Luj55CG6K6+572uXFxuNC4g56iN5ZCO5YaN6K+V77yM5pyN5Yqh5Y+v6IO95pqC5pe25LiN5Y+v55SoJyxcclxuICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKVxyXG4gICAgICB9KTtcclxuICAgIH1cclxuICAgIFxyXG4gICAgaWYgKGVycm9yLm1lc3NhZ2UuaW5jbHVkZXMoJzQwMycpIHx8IGVycm9yLm1lc3NhZ2UuaW5jbHVkZXMoJ3VuYXV0aG9yaXplZCcpKSB7XHJcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMSkuanNvbih7IFxyXG4gICAgICAgIGVycm9yOiAnQVBJ5a+G6ZKl5peg5pWI5oiW5p2D6ZmQ5LiN6LazJyxcclxuICAgICAgICBkZXRhaWxzOiAn5o+Q5L6b55qER2VtaW5pIEFQSeWvhumSpeaXoOaViOaIluiAheayoeaciei2s+Wkn+eahOadg+mZkOiuv+mXruaMh+WumueahOi1hOa6kOOAgicsXHJcbiAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKClcclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICBcclxuICAgIGlmIChlcnJvci5tZXNzYWdlLmluY2x1ZGVzKCc0MjknKSkge1xyXG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MjkpLmpzb24oeyBcclxuICAgICAgICBlcnJvcjogJ+ivt+axgumikeeOh+i/h+mrmO+8jOivt+eojeWQjuWGjeivlScsXHJcbiAgICAgICAgZGV0YWlsczogJ+aCqOW3sui+vuWIsEFQSeivt+axgumZkOWItuOAguivt+WHj+Wwkeivt+axgumikeeOh+aIlueojeWQjuWGjeivleOAgicsXHJcbiAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKClcclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICBcclxuICAgIGlmIChlcnJvci5tZXNzYWdlLmluY2x1ZGVzKCdFTk9URk9VTkQnKSB8fCBlcnJvci5tZXNzYWdlLmluY2x1ZGVzKCdFQ09OTlJFRlVTRUQnKSkge1xyXG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg1MDMpLmpzb24oe1xyXG4gICAgICAgIGVycm9yOiAn572R57uc6L+e5o6l5aSx6LSl77ya5peg5rOV6L+e5o6l5YiwR2VtaW5p5pyN5Yqh44CCJyxcclxuICAgICAgICBkZXRhaWxzOiAnXFxuXFxu5Y+v6IO955qE6Kej5Yaz5pa55qGI77yaXFxuMS4g5qOA5p+l6Ziy54Gr5aKZ6K6+572u77yM56Gu5L+d5YWB6K646L+e5o6l5YiwR29vZ2xlIEFQSVxcbjIuIOWmguaenOS9v+eUqFZQTu+8jOivt+WwneivleaaguaXtuaWreW8gFxcbjMuIOajgOafpee9kee7nOS7o+eQhuiuvue9rlxcbjQuIOeojeWQjuWGjeivle+8jOacjeWKoeWPr+iDveaaguaXtuS4jeWPr+eUqCcsXHJcbiAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKClcclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICBcclxuICAgIGlmIChlcnJvci5tZXNzYWdlLmluY2x1ZGVzKCdBUEkga2V5JykpIHtcclxuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNTAwKS5qc29uKHsgXHJcbiAgICAgICAgZXJyb3I6ICfmnI3liqHlmajphY3nva7plJnor6/vvJpBUEnlr4bpkqXml6DmlYgnLFxyXG4gICAgICAgIGRldGFpbHM6ICfmnI3liqHlmajml6Dms5Xkvb/nlKjmj5DkvpvnmoRBUEnlr4bpkqXjgILor7fmo4Dmn6Xnjq/looPlj5jph4/phY3nva7jgIInLFxyXG4gICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpXHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICBpZiAoZXJyb3IgaW5zdGFuY2VvZiBFcnJvciAmJiBlcnJvci5tZXNzYWdlLmluY2x1ZGVzKCdmZXRjaCBmYWlsZWQnKSkge1xyXG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg1MDApLmpzb24oe1xyXG4gICAgICAgIGVycm9yOiAn572R57uc6ZSZ6K+v6L+e5o6l5YiwR2VtaW5pIEFQSScsXHJcbiAgICAgICAgZGV0YWlsczogJ+WPr+iDveaYr+e9kee7nOi/nuaOpemXrumimOaIlkdlbWluaSBBUEnmnI3liqHkuI3lj6/nlKjjgILor7fmo4Dmn6XnvZHnu5zov57mjqXlubbph43or5XjgIInLFxyXG4gICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpXHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICByZXR1cm4gcmVzLnN0YXR1cyg1MDApLmpzb24oeyBcclxuICAgICAgZXJyb3I6ICfmnI3liqHlmajlpITnkIbor7fmsYLml7blh7rplJknLFxyXG4gICAgICBkZXRhaWxzOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6IFN0cmluZyhlcnJvciksXHJcbiAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpXHJcbiAgICB9KTtcclxuICB9XHJcbn1cclxuIl0sIm5hbWVzIjpbIkdvb2dsZUdlbkFJIiwiYXBpS2V5IiwicHJvY2VzcyIsImVudiIsIkdFTUlOSV9BUElfS0VZIiwiY29uc29sZSIsIndhcm4iLCJhaSIsImhhbmRsZXIiLCJyZXEiLCJyZXMiLCJsb2ciLCJCb29sZWFuIiwibWV0aG9kIiwic2V0SGVhZGVyIiwic3RhdHVzIiwianNvbiIsImVycm9yIiwibWVzc2FnZXMiLCJzeXN0ZW1JbnN0cnVjdGlvbiIsImJvZHkiLCJBcnJheSIsImlzQXJyYXkiLCJ0cmFuc2NyaXB0IiwibWFwIiwibSIsInNlbmRlciIsInRleHQiLCJqb2luIiwicHJvbXB0IiwiY29udHJvbGxlciIsIkFib3J0Q29udHJvbGxlciIsInRpbWVvdXRJZCIsInNldFRpbWVvdXQiLCJhYm9ydCIsImdlbmVyYXRlUmVzcG9uc2UiLCJtb2RlbHMiLCJnZW5lcmF0ZUNvbnRlbnQiLCJtb2RlbCIsImNvbnRlbnRzIiwicm9sZSIsInBhcnRzIiwiY29uZmlnIiwidGVtcGVyYXR1cmUiLCJzaWduYWwiLCJjbGVhclRpbWVvdXQiLCJtb2RlbEVycm9yIiwiZmFsbGJhY2tDb250cm9sbGVyIiwiZmFsbGJhY2tUaW1lb3V0SWQiLCJmYWxsYmFja0Vycm9yIiwicmVzcG9uc2VUZXh0IiwicmVzcG9uc2UiLCJjYW5kaWRhdGVzIiwibGVuZ3RoIiwiY2FuZGlkYXRlIiwiY29udGVudCIsInBhcnQiLCJlcnJvckRldGFpbHMiLCJ0eXBlIiwiRXJyb3IiLCJuYW1lIiwibWVzc2FnZSIsIlN0cmluZyIsInN0YWNrIiwidW5kZWZpbmVkIiwiSlNPTiIsInN0cmluZ2lmeSIsImRldGFpbHMiLCJ0aW1lc3RhbXAiLCJEYXRlIiwidG9JU09TdHJpbmciLCJpbmNsdWRlcyJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/./pages/api/gemini/chat.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../webpack-api-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next"], () => (__webpack_exec__("(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fgemini%2Fchat&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Cgemini%5Cchat.ts&middlewareConfigBase64=e30%3D!")));
module.exports = __webpack_exports__;

})();